
## üóëÔ∏è Note 2: POST DELETE (Delete Posts)

### **Complete Flow for Deleting Posts**

---

### **Step 1: Create Async Thunk for Delete in postSlice.js**
```javascript
import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';
import axios from 'axios';

// Create async thunk for deleting a post
export const deletePost = createAsyncThunk('posts/deletePost', async (id) => {
  await axios.delete(`https://jsonplaceholder.typicode.com/posts/${id}`);
  return id;  // Return the deleted post ID
});
```

---

### **Step 2: Handle Delete in extraReducers**
```javascript
const postsSlice = createSlice({
  name: 'posts',
  initialState: {
    posts: [],
    isLoading: false,
    error: null,
  },
  reducers: {},
  extraReducers: (builder) => {
    // ... other cases ...

    // Delete Post case
    builder.addCase(deletePost.fulfilled, (state, action) => {
      // Filter out the deleted post from the posts array
      state.posts = state.posts.filter((post) => post.id !== action.payload);
    });
  },
});

export default postsSlice.reducer;
```

---

### **Step 3: Implement Delete in Component**
```javascript
// PostView.js
import React, { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { fetchPosts, deletePost } from './postSlice';

const PostView = () => {
  const { isLoading, posts, error } = useSelector((state) => state.posts);
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(fetchPosts());
  }, [dispatch]);

  // Delete handler function
  const handleDeletePost = (id) => {
    // Confirmation dialog
    if (window.confirm('Are you sure you want to delete this post?')) {
      dispatch(deletePost(id));  // Dispatch delete action
    }
  };

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div className="text-red-500">{error}</div>;

  return (
    <div className="max-w-4xl mx-auto p-4">
      <h1 className="text-2xl font-bold mb-6">Posts</h1>

      <div className="space-y-4">
        {posts.map((post) => (
          <div key={post.id} className="border p-4 rounded">
            <h3 className="text-xl font-bold">{post.title}</h3>
            <p className="mt-2">{post.body}</p>
            
            {/* Delete Button */}
            <div className="mt-4">
              <button
                onClick={() => handleDeletePost(post.id)}
                className="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600"
              >
                Delete
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default PostView;
```

---

### **üîÑ Flow Summary:**
```
1. User clicks Delete button
   ‚Üì
2. Confirmation dialog appears
   ‚Üì
3. User confirms ‚Üí dispatch(deletePost(id))
   ‚Üì
4. deletePost thunk makes DELETE request to API
   ‚Üì
5. API deletes the post
   ‚Üì
6. deletePost.fulfilled ‚Üí filter out deleted post from state
   ‚Üì
7. Component re-renders without the deleted post
```

---

### **üìù Key Points:**
- **deletePost(id)**: Async thunk accepts post ID as parameter
- **return id**: After API call, return the ID for filtering
- **filter()**: Remove deleted post from state array
- **window.confirm()**: User confirmation before deletion
- **Optimistic vs Pessimistic Update**: 
  - Current code: Pessimistic (waits for API confirmation)
  - Optimistic: Would update UI immediately, rollback on error

---

### **‚ö° Optional: Add Loading State for Delete**
```javascript
// Enhanced version with delete loading state
const postsSlice = createSlice({
  name: 'posts',
  initialState: {
    posts: [],
    isLoading: false,
    error: null,
    deletingIds: [],  // Track which posts are being deleted
  },
  reducers: {},
  extraReducers: (builder) => {
    // Delete - Pending
    builder.addCase(deletePost.pending, (state, action) => {
      state.deletingIds.push(action.meta.arg);  // Add ID to deleting list
    });
    
    // Delete - Fulfilled
    builder.addCase(deletePost.fulfilled, (state, action) => {
      state.posts = state.posts.filter((post) => post.id !== action.payload);
      state.deletingIds = state.deletingIds.filter(id => id !== action.payload);
    });
    
    // Delete - Rejected
    builder.addCase(deletePost.rejected, (state, action) => {
      state.deletingIds = state.deletingIds.filter(id => id !== action.meta.arg);
      state.error = action.error.message;
    });
  },
});
```

---

### **üîç Comparison: Show vs Delete**

| Feature | POST SHOW | POST DELETE |
|---------|-----------|-------------|
| **HTTP Method** | GET | DELETE |
| **Returns** | Array of posts | Deleted post ID |
| **State Update** | Replace entire posts array | Filter out one post |
| **Loading States** | pending ‚Üí fulfilled ‚Üí rejected | fulfilled only (or all 3 enhanced) |
| **User Interaction** | Automatic on mount | Manual (button click) |
| **Confirmation** | Not needed | Recommended (window.confirm) |

---

**üìå Both operations use the same Redux pattern:**
1. Create async thunk
2. Handle in extraReducers
3. Dispatch from component
4. UI updates automatically based on state changes
